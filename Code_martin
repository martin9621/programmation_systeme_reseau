#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main(int argc, char *argv[]) {
int f,i,etat;

f=fork();
switch (f) {
case -1 :
printf("Erreur fork.\n");
exit(3);
case 0 :
printf("Fils num %d avec PID num %d. PID du pere est %d\n",1,(int)getpid(), (int)getppid());
for(i=1;i<4;i++){
f=fork();
if(f==0) {
printf("Fils num %d avec PID num %d. PID du pere est %d\n",i+1,(int)getpid(),(int)getppid());
exit(1);
}
wait(NULL);
}
exit(0);

default :
printf("Pere avec PID num %d.\n",(int)getpid());
wait(&etat);
printf("Tout est fini.\n");

if (WIFEXITED(etat)) {
    printf("Terminaison normale du processus fils.\n"
           "Code de retour : %d.\n", WEXITSTATUS(etat));
    }
}
}
